!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.normaliz={})}(this,function(e){"use strict";e.normaliz=function e(t,{entity:n,from:r,schema:i,mappings:o={},keys:a={}}={},c={}){if(!t)return c;if("object"!=typeof i||!(i instanceof Array))throw new Error("Invalid schema - expecting an array. Got: "+i);const s=Array.isArray(t);s||(t=[t]);let f=o[n]||n;const y=i.reduce((e,t)=>("object"==typeof t&&t instanceof Array?e[t[0]]=t[1]:e[t]=[],e),{});return c=t.reduce((i,c)=>{const p=Object.assign({},c),u=a[n]?"function"==typeof a[n]?a[n](c):c[a[n]]:c.id;return Object.entries(y).forEach(([t,n])=>{let r=p[t];if(!r)return;let c=a[t]||"id";i=e(r,{entity:t,schema:n,mappings:o,keys:a},i),Array.isArray(r)?p[t]=r.map(e=>"function"==typeof c?c(e):e[c]):p[t]="function"==typeof c?c(r):r[c]}),"function"==typeof f&&(f=o[n](t)),i[f]||(i[f]={}),i[f][u]=p,r&&Object.entries(r).forEach(([e,t])=>{i[e]||(i[e]={}),i[e][t]||(i[e][t]={}),s?(i[e][t][f]||(i[e][t][f]=[]),i[e][t][f].push(u)):i[e][t][f]=u}),i},c)},e.denormaliz=function e(t,{entities:n,schema:r,mappings:i={},keys:o={}}={},a={}){if(!t)return a;if("object"!=typeof r||!(r instanceof Array))throw new Error("Invalid schema - expecting an array. Got: "+r);const c=Object.assign({},t),s=r.reduce((e,t)=>("object"==typeof t&&t instanceof Array?e[t[0]]=t[1]:e[t]=[],e),{});return Object.entries(s).forEach(([t,r])=>{let o=c[t];if(!o)return;const a=t in i?i[t]:t,s=t=>e(n[a][t],{entities:n,schema:r,mappings:i});c[t]=Array.isArray(o)?c[t].map(s):s(o)}),c},Object.defineProperty(e,"__esModule",{value:!0})});
